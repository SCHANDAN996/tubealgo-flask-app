<div x-show="showCompetitorPrompt" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" x-cloak>
    <div @click.away="showCompetitorPrompt = false" class="bg-card rounded-xl shadow-xl w-full max-w-lg text-center p-6">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-brand-purple/10">
            <i class="fa-solid fa-lightbulb text-brand-purple text-2xl"></i>
        </div>
        <div class="mt-3">
            <h3 class="text-lg leading-6 font-bold text-foreground" id="modal-title">Unlock Powerful AI Suggestions</h3>
            <div class="mt-2 px-4">
                <p class="text-sm text-muted-foreground">
                    Our AI generates the best suggestions by analyzing your competitors' successful videos. Add at least one competitor to get started.
                </p>
            </div>
        </div>
        <div class="mt-6 flex gap-3">
            <button @click="proceedWithoutCompetitors()" type="button" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-secondary text-base font-medium text-foreground hover:bg-border">
                Maybe Later
            </button>
            <a href="{{ url_for('competitor.competitors') }}" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary/90">
                Add Competitors
            </a>
        </div>
    </div>
</div>


<div x-show="showTopicPrompt" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" x-cloak>
    <div @click.away="showTopicPrompt = false; promptSuggestions = [];" class="bg-card rounded-xl shadow-xl w-full max-w-lg">
        <div class="p-6">
            <h2 class="text-lg font-bold">Describe Your Video</h2>
            <p class="text-sm text-muted-foreground mt-2">Your title is generic. Please provide a detailed topic for better AI suggestions.</p>
            <div class="relative mt-4">
                <input type="text" x-model="promptTopic" @keyup.debounce.300ms="fetchPromptSuggestions()" @keydown.enter.prevent="handleTopicSubmit()" class="block w-full bg-background border border-input rounded-lg p-3" placeholder="e.g., intraday option selling profit strategy">
                <p x-show="promptError" x-transition class="text-xs text-destructive mt-1" x-text="promptError"></p>
                <div x-show="promptSuggestions.length > 0" class="absolute top-full mt-1 w-full bg-card border rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto">
                    <ul>
                        <template x-for="suggestion in promptSuggestions">
                            <li @click="selectPromptSuggestion(suggestion)" class="p-3 text-sm cursor-pointer hover:bg-secondary" x-text="suggestion.keyword"></li>
                        </template>
                    </ul>
                </div>
            </div>
        </div>
        <div class="p-4 bg-secondary/50 rounded-b-xl flex justify-end gap-2">
            <button type="button" @click="showTopicPrompt = false; promptTopic = ''; promptSuggestions = []" class="bg-secondary px-4 py-2 rounded-lg text-sm font-semibold">Cancel</button>
            <button type="button" @click="handleTopicSubmit()" class="bg-primary text-primary-foreground px-4 py-2 rounded-lg text-sm font-semibold">Generate</button>
        </div>
    </div>
</div>

<div x-show="showTitleModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" @click.self="showTitleModal = false" x-cloak>
    <div class="bg-card rounded-xl shadow-xl w-full max-w-2xl">
        <h2 class="text-lg font-bold p-4 border-b">Choose a Title</h2>
        <ul class="p-4 space-y-2 max-h-[60vh] overflow-y-auto">
            <template x-for="title in suggestedTitles">
                <li @click="selectTitle(title)" class="cursor-pointer p-3 bg-secondary hover:bg-primary/10 rounded-lg" x-text="title"></li>
            </template>
        </ul>
    </div>
</div>

<div x-show="showTagsModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" @click.self="showTagsModal = false" x-cloak>
    <div class="bg-card rounded-xl shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
        <div class="p-4 border-b flex justify-between items-center">
            <h2 class="text-lg font-bold">AI Tag Suggestions</h2>
            <button type="button" @click="executeGenerateTags()" x-show="hasRemovedSuggestion" class="text-xs bg-secondary font-semibold px-3 py-1 rounded-full hover:bg-border" :disabled="loadingState.tags">
                <span x-show="!loadingState.tags"><i class="fa-solid fa-arrows-rotate mr-1"></i> Generate More</span>
                <span x-show="loadingState.tags"><i class="fa-solid fa-spinner animate-spin mr-1"></i> Generating...</span>
            </button>
        </div>
        <div class="p-4 flex flex-wrap gap-2 overflow-y-auto">
            <template x-for="(tag, index) in suggestedTags" :key="index">
                <div class="inline-flex items-center border rounded-lg shadow-sm cursor-pointer transition-all" 
                     :class="selectedSuggestedTags.includes(tag) ? 'bg-primary text-primary-foreground' : 'bg-secondary hover:bg-border'"
                     @click="toggleSuggestedTag(tag)">
                    <span class="text-sm font-semibold px-4 py-2" x-text="tag"></span>
                    <button type="button" @click.stop="removeSuggestedTag(index, tag)" class="text-muted-foreground hover:text-destructive text-sm pr-3 pl-2 border-l"
                            :class="selectedSuggestedTags.includes(tag) ? 'border-primary/50 hover:text-white' : 'border-border'">&times;</button>
                </div>
            </template>
             <p x-show="suggestedTags.length === 0 && !loadingState.tags" class="text-muted-foreground text-sm">No new tags found. Try a different topic.</p>
        </div>
        <div class="p-4 border-t flex justify-end gap-2">
             <button @click="showTagsModal = false" class="bg-secondary px-4 py-2 rounded-lg text-sm font-semibold">Cancel</button>
            <template x-if="selectedSuggestedTags.length > 0">
                <button @click="addSelectedTags()" class="bg-primary text-primary-foreground px-4 py-2 rounded-lg text-sm font-semibold">
                    Add <span x-text="selectedSuggestedTags.length"></span> Selected
                </button>
            </template>
            <template x-if="selectedSuggestedTags.length === 0">
                <button @click="addAllTags()" class="bg-primary text-primary-foreground px-4 py-2 rounded-lg text-sm font-semibold">Add All</button>
            </template>
        </div>
    </div>
</div>